import {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} from "@google/generative-ai";

const apiKey = process.env.EXPO_PUBLIC_GEMINI_API_KEY!;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-2.0-flash-exp",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};

export const chatSession = model.startChat({
  generationConfig,
  history: [
    {
      role: "user",
      parts: [
        {
          text: "Generate a comprehensive travel plan for:\n- **Location**: Darjeeling, West Bengal, India (26.8361645, 88.3058878)\n- **Travel Period**: 02 Jan 2025 to 05 Jan 2025 (4 days)\n- **Travelers**: Solo traveler (1 person)\n- **Budget**: Expensive\n\nThe travel plan should include:\n1. **Flight Details**:\n   - Flight options with prices and booking URLs.\n2. **Accommodation Options**:\n   - Hotels with names, addresses, prices, images, geo-coordinates, ratings, and descriptions.\n3. **Attractions**:\n   - Nearby places to visit with:\n     - Place names\n     - Detailed descriptions\n     - Images\n     - Geo-coordinates\n     - Ticket pricing\n     - Travel time for each place.\n4. **Daily Itinerary**:\n   - Detailed plans for each day, including the best time to visit each attraction.\n5. **Additional Information**:\n   - Weather during the travel period.\n   - Local tips and recommendations.\n\nOutput the response in a **structured JSON format** for seamless app integration.\n",
        },
      ],
    },
    {
      role: "model",
      parts: [
        {
          text: '```json\n{\n  "tripDetails": {\n    "location": {\n      "name": "Darjeeling, West Bengal, India",\n      "coordinates": {\n        "latitude": 26.8361645,\n        "longitude": 88.3058878\n      }\n    },\n    "travelPeriod": {\n      "startDate": "02 Jan 2025",\n      "endDate": "05 Jan 2025",\n      "duration": "4 days"\n    },\n    "travelers": {\n      "type": "Solo",\n      "count": 1\n    },\n    "budget": "Expensive"\n  },\n  "flightDetails": {\n     "disclaimer":"Flight prices and availability are highly variable and should be confirmed closer to the travel date. The following options provide an estimated price range and may require connections.",\n     "options":[\n      {\n        "airline": "Air India",\n        "origin": "Your Origin City",\n        "destination": "Bagdogra Airport (IXB)",\n        "estimatedPrice": "₹10,000 - ₹20,000 (Return)",\n        "bookingUrl": "https://www.airindia.in",\n        "notes":"From Bagdogra Airport, you will need to take a taxi or a pre-booked private car to reach Darjeeling (approx. 3 hours)."\n      },\n      {\n        "airline": "SpiceJet",\n        "origin": "Your Origin City",\n        "destination": "Bagdogra Airport (IXB)",\n         "estimatedPrice": "₹8,000 - ₹18,000 (Return)",\n        "bookingUrl": "https://www.spicejet.com",\n        "notes":"From Bagdogra Airport, you will need to take a taxi or a pre-booked private car to reach Darjeeling (approx. 3 hours)."\n      },\n      {\n        "airline": "IndiGo",\n         "origin": "Your Origin City",\n        "destination": "Bagdogra Airport (IXB)",\n         "estimatedPrice": "₹9,000 - ₹19,000 (Return)",\n        "bookingUrl": "https://www.goindigo.in",\n        "notes":"From Bagdogra Airport, you will need to take a taxi or a pre-booked private car to reach Darjeeling (approx. 3 hours)."\n      }\n    ]\n  },\n  "accommodationOptions": [\n    {\n      "name": "Mayfair Darjeeling",\n      "address": "The Mall, Chauk Bazaar, Darjeeling, West Bengal 734101",\n       "coordinates": {\n        "latitude": 27.0467982,\n        "longitude": 88.2698904\n       },\n      "priceRange": "₹15,000 - ₹30,000 per night",\n      "imageUrl": "https://example.com/mayfairdarjeeling.jpg",\n      "rating": 4.6,\n       "description": "A luxurious heritage hotel offering panoramic views of the Himalayas, excellent dining, and impeccable service. A great experience for solo traveler seeking a comfortable and lavish stay."\n    },\n      {\n      "name": "Windamere Hotel",\n      "address": "Observatory Hill, Darjeeling, West Bengal 734101",\n      "coordinates": {\n         "latitude": 27.0456521,\n         "longitude": 88.2690809\n       },\n      "priceRange": "₹18,000 - ₹35,000 per night",\n      "imageUrl": "https://example.com/windamerehotel.jpg",\n      "rating": 4.7,\n      "description": "A charming colonial-era hotel with old-world charm, beautifully decorated rooms, and a serene atmosphere. Ideal for a solo traveler looking for a tranquil and unique experience."\n    },\n    {\n       "name": "Glenburn Tea Estate & Boutique Hotel",\n        "address": "Near Singtam, Darjeeling, West Bengal 734314",\n        "coordinates": {\n         "latitude": 27.0986359,\n         "longitude": 88.371044\n        },\n        "priceRange": "₹25,000 - ₹45,000 per night",\n        "imageUrl": "https://example.com/glenburnteaestate.jpg",\n        "rating": 4.8,\n        "description": "A luxury tea estate experience with stunning views, tea tasting sessions, and personalized service. Offers a secluded and rejuvenating stay for the discerning solo traveler. Please note this is slightly outside central Darjeeling, approximately 1 hour drive."\n    }\n  ],\n  "attractions": [\n      {\n      "name": "Tiger Hill",\n      "description": "Famous for its panoramic views of the sunrise over Mount Kanchenjunga and other Himalayan peaks. Best to visit early in the morning. A classic Darjeeling experience",\n      "imageUrl": "https://example.com/tigerhill.jpg",\n      "coordinates": {\n        "latitude": 27.0468431,\n        "longitude": 88.2698635\n      },\n      "ticketPrice": "₹50 - ₹100 (vehicle entry fee)",\n      "travelTime": "45 minutes (from central Darjeeling by jeep)",\n      "reviews":[\n        { "author": "Arun S.", "comment":"The sunrise view is breathtaking, truly magical."},\n        {"author": "Priya K.","comment":"Worth waking up early for, but be prepared for the cold."}\n      ]\n    },\n    {\n      "name": "Darjeeling Himalayan Railway (Toy Train)",\n      "description": "A UNESCO World Heritage site, enjoy a ride on the iconic toy train through scenic landscapes.",\n       "imageUrl": "https://example.com/toyTrain.jpg",\n      "coordinates": {\n          "latitude": 27.0440007,\n          "longitude": 88.2677068\n      },\n      "ticketPrice": "₹800 - ₹1500 (depending on the route)",\n      "travelTime": "Varies depending on the route (2-7 hours)",\n       "reviews":[\n          {"author":"Rohan B.","comment":"A unique experience, felt like travelling back in time."},\n          {"author":"Meera L.","comment":"The scenery is stunning, a must do!"}\n        ]\n    },\n        {\n      "name": "Peace Pagoda",\n      "description": "A Japanese-style pagoda built for world peace, offering stunning views of the mountains and Darjeeling town. An ideal place for quiet contemplation.",\n      "imageUrl": "https://example.com/peacepagoda.jpg",\n       "coordinates": {\n        "latitude": 27.0373334,\n        "longitude": 88.2718612\n       },\n      "ticketPrice": "Free",\n      "travelTime": "20 minutes (from central Darjeeling by taxi)",\n      "reviews":[\n        {"author":"Gaurav M.","comment":"Peaceful and serene, a great place for meditation."},\n        {"author":"Anita R.","comment":"The views are spectacular and the architecture is impressive."}\n      ]\n    },\n    {\n      "name": "Padmaja Naidu Himalayan Zoological Park",\n      "description": "Home to rare and endangered Himalayan wildlife like the snow leopard, red panda, and Himalayan black bear. A fascinating place to explore the local fauna.",\n        "imageUrl": "https://example.com/zoopark.jpg",\n      "coordinates": {\n           "latitude": 27.043364,\n           "longitude": 88.2614943\n        },\n      "ticketPrice": "₹100 (approx.)",\n      "travelTime": "15 minutes (from central Darjeeling by taxi)",\n       "reviews":[\n        {"author": "Deepak P.","comment":"Loved seeing the snow leopards and red pandas, worth the visit."},\n         {"author":"Shilpa J.","comment":"Well maintained zoo, a good experience for wildlife enthusiasts."}\n        ]\n    },\n     {\n      "name": "Happy Valley Tea Estate",\n      "description": "One of the oldest tea estates in Darjeeling, offering guided tours and tea tasting sessions. Learn about the art of tea production.",\n      "imageUrl": "https://example.com/happyValley.jpg",\n      "coordinates": {\n        "latitude": 27.0407214,\n        "longitude": 88.2645968\n       },\n      "ticketPrice": "₹200 (approx.)",\n       "travelTime": "10 minutes (from central Darjeeling by taxi)",\n         "reviews":[\n           {"author":"Veena S.","comment":"Great to see the tea making process, loved the tea tasting."},\n          {"author":"Rahul T.","comment":"The tour was very informative and the views were stunning."}\n         ]\n    },\n      {\n          "name":"Ghoom Monastery",\n          "description": "A beautiful Tibetan Buddhist monastery known for its impressive Maitreya Buddha statue. Offers an insight into the rich Tibetan culture in the region.",\n          "imageUrl": "https://example.com/ghoom.jpg",\n          "coordinates":{\n              "latitude": 27.0350905,\n              "longitude": 88.2481078\n          },\n          "ticketPrice": "Free",\n          "travelTime": "30 minutes (from central Darjeeling by taxi)",\n            "reviews":[\n              {"author":"Rakesh K.","comment":"The monastery has a great spiritual vibe, must visit."},\n              {"author":"Swati D.","comment":"Very beautiful and peaceful, enjoyed the visit."}\n            ]\n      }\n  ],\n  "dailyItinerary": {\n      "day1": {\n        "date": "02 Jan 2025",\n        "theme": "Arrival and City Exploration",\n        "schedule": [\n          {"time": "Morning", "activity": "Arrive at Bagdogra Airport (IXB), transfer to Darjeeling by pre-booked taxi (approx 3 hours). Check in to hotel."},\n          {"time": "Afternoon", "activity": "Lunch at a local restaurant. Take a leisurely walk around the Mall Road and enjoy the town’s ambiance."},\n           {"time": "Late Afternoon", "activity":"Visit the Happy Valley Tea Estate for a guided tour and tea tasting."},\n          {"time": "Evening", "activity": "Dinner at the hotel or a fine dining restaurant. Relax and enjoy the evening."},\n            { "time": "Night", "activity":"Optionally explore local night market if available."}\n         ]\n      },\n    "day2": {\n      "date": "03 Jan 2025",\n      "theme": "Sunrise and Heritage",\n      "schedule": [\n        {"time": "Early Morning", "activity": "Visit Tiger Hill for sunrise views (start at around 4:00 am)."},\n        {"time": "Late Morning", "activity": "Have breakfast at your hotel. Then experience the iconic Darjeeling Himalayan Railway (Toy Train Ride)"},\n         {"time": "Afternoon", "activity": "Lunch. Visit the Himalayan Mountaineering Institute and the Padmaja Naidu Himalayan Zoological Park."},\n        {"time": "Evening", "activity": "Enjoy a relaxing spa session at your hotel. Have dinner at a cafe near Mall Road."},\n          { "time": "Night", "activity":"Relax at your hotel or find a cultural performance."}\n      ]\n    },\n        "day3": {\n      "date": "04 Jan 2025",\n      "theme": "Culture and Serenity",\n      "schedule": [\n          { "time": "Morning", "activity": "Visit the Ghoom Monastery and soak in the spiritual atmosphere."},\n          {"time":"Late Morning", "activity":"Visit Peace Pagoda for serene views and meditation"},\n         {"time": "Afternoon", "activity": "Lunch at a restaurant with hill views. Relax, enjoy the tranquility."},\n          {"time":"Late Afternoon","activity":"Optionally indulge in shopping for local handicrafts."},\n          {"time": "Evening", "activity": "Enjoy a special dinner at a restaurant of your choice, trying local delicacies"},\n         { "time": "Night", "activity": "Pre-arrange a private driver for your airport transfer tomorrow."}\n      ]\n    },\n       "day4": {\n      "date": "05 Jan 2025",\n      "theme": "Departure",\n      "schedule": [\n        {"time": "Morning", "activity": "Enjoy a leisurely breakfast at the hotel."},\n        {"time":"Mid-Morning","activity":"Check out from the hotel. Transfer to Bagdogra Airport for your flight back home."}\n      ]\n    }\n  },\n  "additionalInformation": {\n    "weather": "During early January, Darjeeling experiences cold weather with temperatures ranging from 2°C to 10°C. Carry heavy woolens, gloves, caps, and comfortable walking shoes. Snowfall is possible at higher altitudes.",\n    "localTips": [\n      "Book your accommodations and train tickets in advance, especially during peak season.",\n      "Bargain when shopping for souvenirs. Cash is widely accepted, but ensure you have smaller denomination notes. ATMs are available.",\n      "Be mindful of altitude sickness and stay hydrated. Avoid heavy meals and alcohol on arrival.",\n      "Hire a local guide for a more insightful tour of the area.",\n      "Try local delicacies like momos, thukpa, and Darjeeling tea.",\n      "Be respectful of local customs and traditions.",\n      "Pre-arrange private transport for comfort. Drivers can often double as local guides."\n    ]\n  }\n}\n```',
        },
      ],
    },
  ],
});

//   const result = await chatSession.sendMessage(
//     "Generate Travel Plan for Location: New York USA for 1 Days and 1 Night for Family with a Luxury\nbudget with a Flight details, Flight Price with Booking url, Hotels options list with HotelName,\nHotel address, Price, hotel image url, geo coordinates, rating, descriptions and Places to visit\nnearby with placeName, Place Details, Place Image Url, Geo Coordinates, ticket Pricing, Time t\ntravel each of the location for 1 days and 1 night with each day plan with best time to visit in JSON"
//   );
//   console.log(result.response.text());
