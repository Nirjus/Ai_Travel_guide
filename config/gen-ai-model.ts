import {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} from "@google/generative-ai";

const apiKey = process.env.EXPO_PUBLIC_GEMINI_API_KEY!;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-2.0-flash-exp",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};

export const chatSession = model.startChat({
  generationConfig,
  history: [
    {
      role: "user",
      parts: [
        {text: "Generate a comprehensive travel plan for:\n- **Location**: Darjeeling, West Bengal, India (26.8361645, 88.3058878)\n- **Travel Period**: 02 Jan 2025 to 05 Jan 2025 (4 days)\n- **Travelers**: Solo traveler (1 person)\n- **Budget**: Expensive\n\nThe travel plan should include:\n1. **Flight Details**:\n   - Flight options with prices and booking URLs.\n2. **Accommodation Options**:\n   - Hotels with names, addresses, prices, images, geo-coordinates, ratings, and descriptions.\n3. **Attractions**:\n   - Nearby places to visit with:\n     - Place names\n     - Detailed descriptions\n     - Images\n     - Geo-coordinates\n     - Ticket pricing\n     - Travel time for each place.\n4. **Daily Itinerary**:\n   - Detailed plans for each day, including the best time to visit each attraction.\n5. **Additional Information**:\n   - Weather during the travel period.\n   - Local tips and recommendations.\n\nOutput the response in a **structured JSON format** for seamless app integration.\n"},
      ],
    },
    {
      role: "model",
      parts: [
        {text: "```json\n{\n  \"tripDetails\": {\n    \"location\": {\n      \"name\": \"Darjeeling, West Bengal, India\",\n      \"coordinates\": {\n        \"latitude\": 26.8361645,\n        \"longitude\": 88.3058878\n      }\n    },\n    \"travelPeriod\": {\n      \"startDate\": \"2025-01-02\",\n      \"endDate\": \"2025-01-05\",\n      \"durationDays\": 4\n    },\n    \"travelers\": {\n      \"type\": \"solo\",\n      \"count\": 1\n    },\n    \"budget\": \"expensive\"\n  },\n  \"flightDetails\": {\n    \"recommendation\": \"As a solo traveler from a global location, you will need to fly into Bagdogra Airport (IXB), the nearest airport to Darjeeling. From there, you will have to take a taxi or pre-booked car to Darjeeling.\",\n    \"options\": [\n       {\n          \"airline\": \"Multiple airlines (Indigo, SpiceJet, Air India, Vistara)\",\n           \"departureAirport\": \"Your departure airport\",\n           \"arrivalAirport\": \"Bagdogra Airport (IXB)\",\n           \"priceRange\": \"USD 250-600 (depending on origin and time of booking)\",\n           \"bookingURL\": \"https://www.google.com/flights\",\n           \"notes\": \"Prices can fluctuate significantly. Book in advance for better deals. Direct flights might be limited depending on your departure location, and layovers might be necessary, typically in Delhi or Kolkata.\"\n        }\n    ],\n        \"baggageInfo\": \"Check airline website for specific baggage allowance details\"\n\n  },\n  \"accommodationOptions\": [\n    {\n      \"name\": \"Mayfair Darjeeling\",\n      \"address\": \"The Mall, Opposite Governor House, Darjeeling, West Bengal 734101, India\",\n      \"priceRange\": \"USD 250-400 per night\",\n      \"image\": \"https://www.mayfairhotels.com/assets/hotels/gallery/darjeeling/exterior-img.jpg\",\n      \"coordinates\": {\n        \"latitude\": 27.043776,\n        \"longitude\": 88.258095\n      },\n       \"rating\": 4.6,\n       \"description\": \"A luxury heritage hotel with opulent rooms, stunning views, and excellent dining options. Known for its impeccable service and classic architecture.\"\n    },\n    {\n      \"name\": \"The Elgin, Darjeeling\",\n      \"address\": \"18, H.D. Lama Road, Darjeeling, West Bengal 734101, India\",\n       \"priceRange\": \"USD 200-350 per night\",\n      \"image\": \"https://media-cdn.tripadvisor.com/media/photo-s/0e/6e/83/8f/the-elgin-darjeeling.jpg\",\n      \"coordinates\": {\n        \"latitude\": 27.049077,\n        \"longitude\": 88.256350\n      },\n      \"rating\": 4.5,\n      \"description\": \"A charming heritage hotel offering colonial-era elegance, beautiful gardens, and a cozy atmosphere.\"\n    },\n       {\n      \"name\": \"Glenburn Tea Estate & Retreat\",\n      \"address\": \"Singritan, Darjeeling, West Bengal 734101, India\",\n       \"priceRange\": \"USD 400-600 per night\",\n      \"image\": \"https://glenburnteaestate.com/wp-content/uploads/2021/11/Glenburn-tea-estate-luxury-hotel-in-darjeeling-1-e1669696503654.jpg\",\n      \"coordinates\": {\n        \"latitude\": 26.983075,\n         \"longitude\": 88.288263\n      },\n      \"rating\": 4.8,\n       \"description\": \"A luxurious tea estate experience. Offers stunning views, private tours of the plantation, and a refined dining experience. A bit outside of Darjeeling town but a unique option.\"\n    }\n  ],\n  \"attractions\": [\n    {\n      \"name\": \"Tiger Hill\",\n      \"description\": \"Famous for its spectacular sunrise views over the Kanchenjunga mountain range. The panoramic views are breathtaking.\",\n      \"image\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/7/79/Tiger_Hill_Sunrise_view_from_Darjeeling.jpg/800px-Tiger_Hill_Sunrise_view_from_Darjeeling.jpg\",\n      \"coordinates\": {\n        \"latitude\": 27.054528,\n        \"longitude\": 88.261527\n      },\n      \"ticketPrice\": \"INR 50-100 per person (entry fee for viewing platform)\",\n      \"travelTime\": \"45 mins - 1 hour from the city center by taxi.\" ,\n       \"bestTimeToVisit\": \"Early morning before sunrise (around 4:00 AM - 5:00 AM)\"\n    },\n      {\n      \"name\": \"Batasia Loop\",\n      \"description\": \"A scenic railway loop with a memorial dedicated to Gorkha soldiers. Offers panoramic views of the Darjeeling Himalayan Railway and the surrounding hills.\",\n       \"image\":\"https://upload.wikimedia.org/wikipedia/commons/thumb/c/ce/Batasia_loop_darjeeling.jpg/800px-Batasia_loop_darjeeling.jpg\",\n      \"coordinates\": {\n        \"latitude\": 27.045587,\n        \"longitude\": 88.265895\n      },\n      \"ticketPrice\": \"INR 15 per person (small fee to enter)\",\n       \"travelTime\": \"15 - 20 minutes from Darjeeling by Taxi.\",\n      \"bestTimeToVisit\": \"Anytime during the day, but morning offers clearer views.\"\n    },\n      {\n      \"name\": \"Darjeeling Himalayan Railway (Toy Train)\",\n        \"description\": \"A UNESCO World Heritage site, experience a ride on the charming toy train. Choose between a short joyride or a longer route.\",\n       \"image\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/Darjeeling_Himalayan_Railway_02_B.jpg/800px-Darjeeling_Himalayan_Railway_02_B.jpg\",\n       \"coordinates\": {\n        \"latitude\": 27.040876,\n        \"longitude\": 88.258959\n      },\n      \"ticketPrice\": \"INR 1000 - 1500 for joyrides; longer routes can be more expensive.\",\n       \"travelTime\":\"Train station is within the city, so the journey time depends on the route chosen. Allow for at least 2-3 hours\",\n      \"bestTimeToVisit\":\"Morning rides are ideal.\"\n    },\n    {\n      \"name\": \"Peace Pagoda\",\n       \"description\":\"A Japanese Buddhist temple offering a serene and peaceful atmosphere with panoramic views of the city. A great place for reflection.\",\n       \"image\":\"https://upload.wikimedia.org/wikipedia/commons/thumb/3/30/Darjeeling_Peace_Pagoda.jpg/800px-Darjeeling_Peace_Pagoda.jpg\",\n      \"coordinates\": {\n        \"latitude\": 27.027206,\n        \"longitude\": 88.273687\n      },\n      \"ticketPrice\": \"Free entry\",\n       \"travelTime\": \"20-30 minutes from the city center by Taxi.\",\n       \"bestTimeToVisit\":\"Morning or late afternoon for the best views.\"\n    },\n    {\n     \"name\": \"Padmaja Naidu Himalayan Zoological Park\",\n        \"description\": \"Home to high altitude animals such as red pandas, snow leopards, and Himalayan wolves.\",\n        \"image\": \"https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Red_panda_in_Padmaja_Naidu_Himalayan_Zoological_Park_Darjeeling_02.jpg/800px-Red_panda_in_Padmaja_Naidu_Himalayan_Zoological_Park_Darjeeling_02.jpg\",\n      \"coordinates\": {\n        \"latitude\": 27.042065,\n        \"longitude\": 88.262819\n       },\n       \"ticketPrice\": \"INR 100 per person\",\n       \"travelTime\": \"10-15 mins from the city center by taxi\",\n      \"bestTimeToVisit\": \"Morning is ideal\"\n    },\n    {\n     \"name\": \"Happy Valley Tea Estate\",\n        \"description\": \"One of Darjeeling's oldest tea estates, offering guided tours to learn about the tea-making process and enjoy tea tasting.\",\n       \"image\":\"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e2/Happy_Valley_Tea_Estate_in_Darjeeling_03.jpg/800px-Happy_Valley_Tea_Estate_in_Darjeeling_03.jpg\",\n       \"coordinates\": {\n          \"latitude\": 27.037084,\n           \"longitude\": 88.252638\n      },\n      \"ticketPrice\": \"INR 50-100 (small fee for tour and tasting)\",\n      \"travelTime\": \"10 - 15 minutes from the city center by taxi\",\n      \"bestTimeToVisit\": \"Mid-morning or afternoon for the tour\"\n      }\n  ],\n  \"dailyItinerary\": {\n    \"day1\": {\n      \"date\": \"2025-01-02\",\n      \"activities\": [\n        {\"time\": \"Afternoon\", \"description\": \"Arrive at Bagdogra Airport (IXB). Take a pre-booked car/taxi to Darjeeling (approximately 3-4 hours). Check into your hotel. Relax and acclimatize to the altitude.\" },\n        {\"time\": \"Evening\", \"description\": \"Stroll around the Mall Road, enjoy local cuisine at a restaurant, and enjoy the evening atmosphere.\"}\n      ]\n    },\n    \"day2\": {\n      \"date\": \"2025-01-03\",\n       \"activities\":[\n        {\"time\": \"Early Morning (4:00 AM)\", \"description\": \"Depart for Tiger Hill to witness the sunrise over Kanchenjunga. \"},\n        {\"time\": \"Morning\", \"description\": \"Visit Batasia Loop and enjoy the scenic views, and visit the Gorkha war memorial.\"},\n        {\"time\": \"Late Morning\", \"description\":\"Explore the Padmaja Naidu Himalayan Zoological Park and see the unique high altitude animals.\"},\n         {\"time\":\"Afternoon\", \"description\": \"Lunch at a local cafe and explore local shops.\"},\n        {\"time\":\"Evening\",\"description\":\"Enjoy a leisurely ride on the Darjeeling Himalayan Railway (toy train) and then have dinner at a fine-dining establishment.\"}\n        ]\n    },\n    \"day3\": {\n       \"date\": \"2025-01-04\",\n      \"activities\": [\n        {\"time\": \"Morning\", \"description\":\"Visit the Peace Pagoda for a serene experience and great city views.\"},\n        {\"time\": \"Late Morning\", \"description\":\"Explore the Happy Valley Tea Estate, take a tour and enjoy some tea tasting.\"},\n        {\"time\":\"Afternoon\", \"description\":\"Enjoy a relaxing lunch at a local restaurant and spend the afternoon relaxing or shopping.\"},\n        {\"time\": \"Evening\", \"description\": \"Enjoy a cultural performance if available or a quiet dinner at your hotel or a recommended restaurant.\" }\n      ]\n    },\n     \"day4\": {\n       \"date\": \"2025-01-05\",\n      \"activities\": [\n        {\"time\":\"Morning\", \"description\": \"Enjoy a leisurely breakfast at your hotel. Depending on flight timings, you can explore any remaining areas.\"},\n        {\"time\": \"Afternoon\", \"description\":\"Check out from the hotel and transfer to Bagdogra Airport (IXB) for your flight home.\" }\n\n      ]\n    }\n  },\n  \"additionalInformation\": {\n    \"weather\": \"Darjeeling experiences cold weather in January. Expect temperatures ranging from 0 to 10 degrees Celsius. It may snow during the period. Pack warm clothing, including layers, gloves, and hats. Carry comfortable walking shoes and rain gear.\",\n    \"localTips\": [\n      \"Book accommodations and flights in advance, especially during peak season.\",\n      \"Hire a local taxi for sightseeing or pre-book a car for easy transportation.\",\n      \"Bargaining is common in local markets.\",\n      \"Carry cash, as not all establishments accept cards.\",\n       \"Try local delicacies like Momos, Thukpa, and Darjeeling tea.\",\n       \"Be aware of altitude sickness and take time to acclimatize to the change in elevation. Drink plenty of water.\"\n    ],\n    \"recommendations\": [\n        \" Consider hiring a local guide for a more enriched experience.\",\n        \"Always keep a copy of important travel documents and IDs.\",\n        \"Be aware of your surroundings, especially during late hours\",\n        \"Always stay hydrated and carry snacks with you\",\n        \"Enjoy the beautiful scenery and the serene atmosphere of Darjeeling\"\n    ]\n  }\n}\n```\n"},
      ],
    },
  ],
});

//   const result = await chatSession.sendMessage(
//     "Generate Travel Plan for Location: New York USA for 1 Days and 1 Night for Family with a Luxury\nbudget with a Flight details, Flight Price with Booking url, Hotels options list with HotelName,\nHotel address, Price, hotel image url, geo coordinates, rating, descriptions and Places to visit\nnearby with placeName, Place Details, Place Image Url, Geo Coordinates, ticket Pricing, Time t\ntravel each of the location for 1 days and 1 night with each day plan with best time to visit in JSON"
//   );
//   console.log(result.response.text());
